由软件需要设计想到的
====================

>文中图片均来自网络

#一个问题引发的思考

不久前，参加了一个OO训练营，在课上讲师问了这样一个问题，**为何软件要设计？**
这样一个开放话题引发了学员们的思考，他们思索的是“好的软件设计能为软件带来何种好处”，而我却被另一个问题着迷：**我们是如何演进到软件需要设计？**

关于**我们是如何演进到软件需要设计**，我想到这样一句话：

>软件领域永恒的主题是如何做正确的事和如何正确的做事 ——《实例化需求》

如何做正确的事属于世界观，而如何正确的做事则是方法论，对我们中大多数人来说，方法论远比世界观要重要，因为那很可能会是我们谋生的手段。既然如此重要，那么如何做才算正确？让我们引用《重构》一书中Martin Fowler自己的描述来解答一位程序员的典型进化史：

>初学编程的时候，我埋头就写程序，浑浑噩噩地进行开发。然而很快我便发现，事先做好设计可以让我节省返工的高昂成本。于是我很快加强这种“预先设计”风格。

业界大牛用他亲身经历告诉我们设计不是一天造就的而是经过我们自己的实践摸索或是别人的指点教导产生的。这个过程可能会是一个相当长的时间，我们会在这个很长的演进阶段里学习流程图、伪代码直至UML，利用上述设计工具让我们至少在内心建立起一个有边界、可操作的软件蓝图。现在设计也摆到开发人员手边了，是否就可以期待一个优雅的软件产品可以顺利地诞生了？

>许多人都把设计看做软件开发的关键环节，而把编程看做只是机械式的低级劳动。他们认为设计就像画工程图而编码就像施工。但是你要知道，软件和技巧有着很大的差异：软件的可塑性更强，而且完全是思想产品。  —— 《重构》

很不幸，残酷现实无情地告诉我——不尽然！现实中随手拣起手边的代码就能发现充斥着大量冗长、晦涩、复杂的代码段，连我自己也不能幸免。这不禁引导我思考一个更深的问题，既然有了设计，**为何我们还会写长代码？**

#情怀、教育、技术及现实

谈到长代码出现的缘由，下意识想到的竟然是武侠，也许程序员天生就是侠骨，深知行走江湖，“一寸长一寸强”的武侠真谛，如果软件行业比作江湖，那代码便是侠客手中的长剑，正所谓“长刀在手，天下我有”，代码越长挥舞起来就越是酣畅淋漓。在很多侠客看来，没法使用长剑的侠客终究只能是还未出师的学徒，而快意恩仇，仗剑天涯才是人生大境界，快哉！壮哉！也许正是这种侠客情怀让大多数人执着于此。

![sword](http://pic.58pic.com/58pic/12/95/68/27N58PICkpb.jpg)

情怀之外，我们经历的软件教育似乎也对长代码起了推波助澜的作用。对一个刚学编程的人来说，阅读或编写一段长代码充满了挑战，而越短的代码越容易让初学者对编程有个大体印象，越容易让初学者模仿，也越容易让人起步，因此几乎所有编程语言的例子都是从只有若干行的hello world开始。随着时间的推移，特别是分支、循环的加入，程序体开始逐渐膨胀，开发者也希望摆脱初学者的卑微称号，于是所有人开始向着长代码进行，一夜之间长长的代码变成了区分初学者和高手的分界线，谁的代码越长，嵌套的分支、循环越多，水平就越高。我们的老师也是按照这样的流程来教导我们，更会鼓励我们去写长代码。从技能水平演进的角度出发，鼓励写长代码无疑是正确的，这对锻炼开发者了解代码整体结构和逻辑大有裨益，没有早期训练，就不可能产生大量可以从事软件工作的劳动力。

>早期的编程语言中，子程序调用需要额外开销，这使得人们不太乐意使用小函数 —— 《重构》

这里又存在一个悖论，任何人似乎对过于长篇幅的事务，如会议、报告、说明书都会在早期就反应出不适应，这些反应包括：注意力不集中、困倦、抵触甚至拒绝，因而短篇幅从人的本能上更加受欢迎。不过技术上的考量有时候会成为决定因素，不少人使用冗长代码的原因是由于担心函数切换过程中产生的开销，特别是在那些对资源使用存在较大限制的场景中。如此小心翼翼地控制子程序的使用，实际上牺牲人的创造性而去提升机器的性能，因为人花在的创造性上的能量被阅读理解程序的上下文转换所占用，还有一部分要用于抑制由于长篇幅对自身机体造成的不良反应。

如果从人类进化的角度考量程序员，那么大致可以把程序员分成3类

![evolution](http://pic1.mofangge.com/upload/papers/c09/20120412/2012041210534007413389.gif)

* 原始人，即刚入门的初学者，一个方法或函数会囊括所有流程，一条main路通罗马，开发者通常在这个阶段停留的时间很短；
* 摩登原始人，会把流程拆分到几个函数中，但每个函数其实只是main的微缩，多数人会在此停留很长时间，这个阶段会给人一种错觉，那就是“你已经足够好，只有高手才能驾驭长代码”；
* 现代人，函数按照功能分解，表意清晰，更重要的特征是对长代码有种敏感；

时间是软件开发者最大的敌人，时间维度的约束导致开发者会采用照搬修改现有实现或者平铺直叙的方式来进行对抗

还有一个敌人是疲劳，也许你也有过这样的体会，不想再多看一行代码。


