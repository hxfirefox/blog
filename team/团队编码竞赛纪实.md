团队编码竞赛纪实
================

竞赛特别是编码竞赛听起来挺唬人，至少我是这么认为的，似乎参加编码竞赛的都应该是些不修边幅、思维跳跃的程序怪咖，像自己这种普普通通的码农应该和这种竞赛是绝缘的。不过幸运的是一次参加agile coach面试的经历改变了我对竞赛的看法，让我对它有了新的认识，并最终促成我在团队策划了一次竞赛。在这还要感谢团队的scrum master，他对面试经历的感同身受让我们有机会一起完成这项我们这个团队的先河。

Agile Coach面试的经历告诉我，尽管竞赛存在优胜劣汰，但是透过竞赛这种形式可以从几个维度了解"如何正确地做产品"，这种体验不是由在竞赛中获胜产生，相反这是在竞赛中的每一次问答，每一次的点评获得的，在审查别人的同时也是审视自己，这种体会是可以传递给团队的，这也是我们策划团队编码竞赛的初衷。

当我就编码竞赛与团队成员沟通时，团队成员都对比赛表示出了很大的兴趣，特别是我承诺的此次竞赛将会带来全新的体验充满了好奇。部门也对推进这次编码竞赛给予了很大的支持，给予了资金上的支持。获得团队的意愿和部门的资金后，接下来的就是制定竞赛的流程和规则。

竞赛分成两个阶段进行，第一阶段从8月7日到8月11日结束，这一阶段以编码为主题，竞赛发布一道编程试题包含若干需求，参赛人员将完成该试题中包含的所有功能；第二阶段为8月14日，这一阶段包含作品展示、点评以及编码，以互动为主题，在该阶段参赛人员将阐述作品设计思路，并接受其他参赛人员的点评，随后竞赛发布该编程试题的后续若干需求，要求参赛人员现场完成编程。在设计竞赛时，为了兼顾团队成员开发技能平衡及竞赛周期，竞赛的参赛对象是以2～3人小组为单位的，即要求开发人员结对，为了防止出现小组中某位成员的技能过强，包办一切，竞赛第二阶段特别要求代码编写者不作为展示作品时的讲解人，并在现场编程过程中变换代码编写者，这样做可以使得小组所有成员都能够得到机会展示自己，并逐步使得结对人对代码的认识达到一致认识的程序。按照上述设计，团队成员自动自愿组成了三支开发小组，并取了三个十分有意思的队名：Let me think、透心凉、一地西瓜。

竞赛试题参考了[cyber-dojo](cyber-dojo.org)上一道名为yatzy的练习题，第一阶段试题如下：
>Yatzy骰子游戏，每位玩家拥有5枚骰子(点数1～6)，当每位玩家掷出所有骰子后，电脑会随机选取一种计分规则(如ones、twos等)，如果玩家的骰子点数落入规则所描述的区间，则按照规则获得积分，反之不得分，例如：
>
>*玩家点数为5-6-5-5-2，当计分规则为fives时，玩家将获得15分(5+5+5)*
>
>游戏持续5轮，计算5轮总分，高分者获得比赛胜利
>
>现编制一个程序，需求如下：
>
>1. 规则Chance:
>  The player scores the sum of all dice,
  no matter what they read.
>  
>  For example,
>  
>  - 1,1,3,3,6 placed on "chance" scores 14 (1+1+3+3+6)
>  - 4,5,5,6,1 placed on "chance" scores 21 (4+5+5+6+1)
>
>2. 规则Yatzy:
>  If all dice have the same number,
  the player scores 50 points.
>  
>  For example,
>
>  - 1,1,1,1,1 placed on "yatzy" scores 50
>  - 5,5,5,5,5 placed on "yatzy" scores 50
>  - 1,1,1,2,1 placed on "yatzy" scores 0
>
>3. 输出5轮之后获胜玩家及得分
>
>4. 规则Ones, Twos, Threes, Fours, Fives, Sixes:
>  The player scores the sum of the dice that reads one,
  two, three, four, five or six, respectively.
>
>  For example,
>
>  - 1,1,2,4,4 placed on "fours" scores 8 (4+4)
>  - 2,3,2,5,1 placed on "twos" scores 4  (2+2)
>  - 3,3,3,4,5 placed on "ones" scores 0
>
>5. 规则Pair:
>  If exactly two dice have the same value then
  the player scores the sum of the two highest matching dice.
>
>  For example, when placed on "pair"
>
>  - 3,3,3,4,4 scores 8 (4+4)
>  - 1,1,6,2,6 scores 12 (6+6)
>   3,3,3,4,1 scores 0
>   3,3,3,3,1 scores 0

第一阶段只为参赛队伍设定了比赛时间和试题，其他由参赛者自由发挥。参赛队伍很快就发挥出自组织的积极性，工作之余时常可以看到开发小组聚集在一起，2～3人的开发团队也很适合参赛者交流想法。正当参赛队伍热火朝天的时候，竞赛规则和第二阶段的需求也被制定了出来，竞赛评分也分两阶段，第一阶段的评分从测试、OO设计、结构、规范、功能及界面维度对参赛作品进行评判，主要关注参赛队伍的设计思路，编码规范等，由评委完成；第二阶段的评分分为参赛队伍互相打分与评委打分两部分，参赛队伍互评采用了与第一阶段评分相同的规则，而评委打分部分则从TDD、协作、点评、讲解维度进行评判，重点在于考察团队协作、沟通及快速修正的能力。

由于试题难度不高，因此所有参赛队伍都很快提交了作品。竞赛第二阶段也正式拉开了大幕，第二阶段的流程包含了许多互动环节，首先每队将获得4分钟时间来讲解作品的设计思路，其他参赛队将在讲解后对作品进行点评和提问，每队限时4分钟，评委将对每队的点评和讲解进行打分，接下来竞赛将发布新一轮需求，每队进行20分钟的编码，之后重复之前的点评，现场编程将进行两轮，最后取所有评分总和最高队伍获得优胜。为了增加竞赛的趣味性，竞赛组织特意买了一个西瓜放在竞赛现场，作为最后优胜的奖品，优胜者将获得西瓜的分配权。

![race](http://img3.a.pcs.baidu.com/rest/2.0/pcs/thumbnail?method=generate&path=%2FIMG_20150814_160410_917.jpg)

第二阶段一开始时各个参赛队伍对自己作品的讲解环节，各个队都是第一次参与这种项目，有点不适应，几乎没有参赛队讲解到真正的设计思路，大多数队伍讲解了代码结构和实现方式，其实这个阶段就是想让参赛队了解和学习什么是需求的真正核心部分，需求可以分解成多少个功能点，尽管参赛队完成的作品的质量都不错，但是在讲解过程中并没有表现出与之相应的水平。接下来的点评，参赛队似乎又些许腼腆了些，大多数以提问的方式进行，很少有直接指出对方代码设计中存在的坏味道，这个环节把考察参赛选手clean code能力放在了重点上，如果无法发现对方代码中存在的问题，那么就意味着很可能在自己代码中也存在的相同的问题。如此一轮点评下来，似乎参赛队伍都没有找到如何去进行讲解和点评的技巧，同时在讲解的过程发现了不少参赛队存在明显的过度设计问题，出现了一些不存在的功能。此外大家对于time box的控制也存在不足，要不就是一言不发白白浪费发现问题和学习的机会，要不就是说的太多而缺乏重点。见到这种场景，我们评委适当地暂停了比赛，开始向参赛队伍讲述这些点评和讲解的目的，并重点说明了为何大家会出现过度设计，引发大家对于需求沟通和简单设计的思考。因为有了前后对照，参赛队对于比赛环节的表现出来的技能需求有了更深刻的认识，见此机会，我们决定趁热打铁，拿出试题的新需求，并要求参赛队伍进行20分钟的现场编程，参赛队伍可以实现新需求也可以进行重构。

新的需求是在原题的基础上进行了渐进式的扩展，前面的几处零散需求可能还无法看出题目的真正目的，但是新加入的需求可以让参赛队认识到设计的重要性，较好的设计会带来可维护性、可拓展性的增强。新的两轮编程需求如下：

>6. 规则Two pairs:
  If exactly two dice have the same value and exactly
  two dice have a different value then the
  player scores the sum of these four dice.
>  
>  For example, when placed on "two pairs"
>
>  - 1,1,2,3,3 scores 8 (1+1+3+3)
>  - 1,1,2,3,4 scores 0
>  - 1,1,2,2,2 scores 0
>
>7. 规则Three of a kind:
  If there are exactly three dice with the same number
  then the player scores the sum of these dice.
>  
>  For example, when placed on "three of a kind"
>
>  - 3,3,3,4,5 scores 9 (3+3+3)
>  - 3,3,4,5,6 scores 0
>  - 3,3,3,3,1 scores 0
>
>8. 规则Full house:
  If the dice are two of a kind and three of a different kind
  then the player scores the sum of all five dice.
>  
>  For example, when placed on "full house"
>
>  - 1,1,2,2,2 scores 8 (1+1+2+2+2)
>  - 2,2,3,3,4 scores 0
>  - 4,4,4,4,4 scores 0
>
>9. 规则Small straight:
  When placed on "small straight", if the dice read
  1,2,3,4,5, the player scores 15 (the sum of all the dice).

结束编程后，依然是点评的环节，有了前面的经验，参赛队开始慢慢进入状态，游刃有余起来，不少参赛队的点评逐渐深入到了代码设计核心部分，通过现场编程和对比使得参赛队伍能够自我发现什么样的设计是合理的，哪些坏味道是需要避免的，有了比较才能便于发现问题，相互学习相互借鉴也能更加提升技能。最后通过相互打分，更加客观地体现了参赛队在整个过程中的体验，发现别人的亮点并倾听自己的缺点，既学习借鉴又可以防微杜渐。

最终的比赛结果是let me think队获得了优胜，大家一起分享了由他们分配的西瓜。通过比赛有许多值得思考。

- 团队对于XP实践的检验如何去做，工作代码带来问题是由于工作具有强制性，规范更容易被执行，但这和开发人员的习惯是有很大差别的，通过比赛这种非工作代码编写，很容易暴露出开发人员的编码习惯，是否是真正领会了TDD的内涵还是仅仅是形式上的模仿并不难区别。从这次竞赛中看出大家对于测试驱动开发还结合的不是太好，多多少少会出现开发驱动测试的问题，因此对于XP的实践检验应当定期或不定期地去进行，尽量引导大家形成TDD的习惯。
- 简单设计不是一件容易做到的事，缺乏领域知识或经验技能不足都会带来设计的复杂化，更重要的是需求的沟通，程序员喜欢想当然的去添加一些需求中不存在的东西，或是误解了需求中想要表达的意思，因此沟通是改进的重点，更重要的是要具备沟通的思想，这一点还需要在今后的工作中更多地去进行宣贯。
- 代码坏味道不是一句玩笑话，程序员从自身视界观察代码，往往会拔高代码理解的门槛，通常认为只要别人不是傻瓜就应该能看明白这个复杂的表达式，那个不知所云的变量和函数，却忘记了别人具备的技能的差异性，这如同读书，如果写书的人总是用一些玄妙晦涩的词句来描述，那这样的书一定会被读书弃之不用，因为它无法让人读下去。想要改变这一点，加强团队的代码走查是较好的解决方法。
